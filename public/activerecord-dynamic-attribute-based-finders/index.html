<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>ActiveRecord dynamic attribute-based finders</title>
   <meta name="author" content="Frederik Dietz" />
   <link href="http://feeds.feedburner.com/tom-preston-werner" rel="alternate" title="Frederik Dietz" type="application/atom+xml" />

   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
   <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen, projection" />

   <script type="text/javascript" src="http://use.typekit.com/jpd0pfm.js"></script>
   <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>
<body>

<div class="site">
  <div class="title">
    <a href="/">Frederik Dietz</a>
    <a class="extra" href="/">home</a>
  </div>
  
  <div id="post">
I'm more used to Java ORM frameworks as for example JPA and Hibernate but started to play around with ActiveRecord lately. Probably all has been said already and I will spare you the introduction and point you to some <a href="http://rails-doc.org/rails/ActiveRecord/Base">documentation</a> instead. It took me some time to realize that there is much more than what is shown mostly in online articles, blog postings and books. 

Let's start with the typical example of a book model containing articles defined with a simple has_many relation.

[sourcecode language='ruby']
class Book < ActiveRecord::Base
  has_many :chapters
end

class Chapter < ActiveRecord::Base
  belongs_to :book
end
[/sourcecode]

A typical query for all books would then look like this:

[sourcecode language='ruby']
Book.find(:all)
[/sourcecode]

and a query for all published books would be something similar to:

[sourcecode language='ruby']
Book.find(:all, :conditions => [ 'status = ?', false])
[/sourcecode]

Now to simplify this we can instead use the dynamic finder:

[sourcecode language='ruby']
Book.find_all_by_status(false)
[/sourcecode]

Until now this is pretty straightforward, but now comes the interesting part. Imagine now that you have got a book and you want to retrieve a list of chapters:

[sourcecode language='ruby']
@book = Book.find(params[:id])
@chapters = @book.chapters.find_all_by_title(title)
[/sourcecode]

Notice how one can use the same dynamic finders directly on the child association? Much easier than making a query using the book_id foreign key in the chapters table! In fact, ActiveRecord automatically makes the class-level methods of the Chapter model available directly for the associations. This also works in case you have added your own finder methods in the model.

[sourcecode language='ruby']
class Chapter < ActiveRecord::Base
  belongs_to :book

  def self.find_finished
    Chapter.find_all_by_status(false)
  end
end
[/sourcecode]

Note, the "self" since we are adding a class-level method to Chapter. ActiveRecord will automatically make this now available in the association:

[sourcecode language='ruby']
@chapters = @book.chapters.find_finished
[/sourcecode]

Hope you got the idea. It simply is beautiful. Next time we should probably look into what's behind the <a href="http://rails-doc.org/rails/ActiveRecord/Base/find/class">dynamic finder method</a>.

</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>27 Sep 2009</span> &raquo; <a href="/caffeinated-simpleton-%25c2%25bb-blog-archive-%25c2%25bb-an-introduction-to-javascript%25e2%2580%2599s-%25e2%2580%259cthis%25e2%2580%259d">Caffeinated Simpleton  » Blog Archive  » An Introduction to JavaScript’s “this”</a></li>
    
      <li><span>19 Sep 2009</span> &raquo; <a href="/adding-columns-to-large-mysql-tables-quickly">Adding Columns to large MySQL Tables Quickly</a></li>
    
      <li><span>08 Sep 2009</span> &raquo; <a href="/state-of-the-couch">State of the Couch</a></li>
    
  </ul>
</div>
  
  <div class="footer">
    <div class="contact">
      <p>
        Frederik Dietz<br />
        fdietz@gmail.com
      </p>
    </div>
    <div class="contact">
      <p>
        <a href="http://github.com/fdietz/">github.com/fdietz</a><br />
        <a href="http://twitter.com/fdietz/">twitter.com/fdietz</a><br />
      </p>
    </div>
    
    <!-- <div class="rss">
      <a href="http://feeds.feedburner.com/fdietz">
        <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
      </a>
    </div> -->
    
  </div>
</div>

<a href="http://github.com/fdietz"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" /></a>

<!-- Google Analytics -->
<script type="text/javascript">
// var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
// document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
// var pageTracker = _gat._getTracker("UA-6016902-1");
// pageTracker._trackPageview();
</script>
<!-- Google Analytics end -->

</body>
</html>
